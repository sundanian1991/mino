# Book Processor - 详细工作流程

---

## 完整工作流

```
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  Step 1     │ → │  Step 2     │ → │  Step 3     │
│  PDF 转文本   │   │  识别结构   │   │  拆分章节   │
└─────────────┘   └─────────────┘   └─────────────┘
       ↓
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  Step 6     │ ← │  Step 5     │ ← │  Step 4     │
│  质量审查   │   │  批量处理   │   │  单章深度   │
└─────────────┘   └─────────────┘   └─────────────┘
```

---

## Step 1: PDF 转文本

### 1.1 检查环境

```bash
# 检查是否安装 poppler
pdftotext -v

# 如未安装，执行：
brew install poppler
```

### 1.2 转换 PDF

```bash
# 基础转换
pdftotext -layout input.pdf output.md

# 带编码指定（如遇乱码）
pdftotext -layout -enc UTF-8 input.pdf output.md
```

### 1.3 验证结果

```bash
# 检查行数
wc -l output.md

# 预览内容
head -50 output.md
```

---

## Step 2: 识别章节结构

### 2.1 读取文件

```bash
# 读取前 100 行（通常包含目录）
head -100 output.md
```

### 2.2 让 AI 分析结构

**Prompt**:
```
请分析这份文档的章节结构：

1. 共有几个章节？
2. 每章的标题是什么？
3. 每章大约从哪一行开始？
4. 是否有子章节？

请用表格形式输出。
```

### 2.3 记录章节信息

创建 `chapters.md` 记录：

```markdown
| 章节 | 标题 | 起始行 | 结束行 | 页数 |
|------|------|--------|--------|------|
| 01 | 认识四五表 | 1 | 300 | 1-17 |
| 02 | 了解四五表 | 301 | 600 | 18-31 |
```

---

## Step 3: 拆分章节

### 3.1 按页码拆分（推荐）

```bash
# 第一章（1-17 页）
pdftotext -layout -f 1 -l 17 input.pdf 01-chapter1.md

# 第二章（18-31 页）
pdftotext -layout -f 18 -l 31 input.pdf 02-chapter2.md
```

### 3.2 按行号拆分（备选）

```bash
# 使用 head/tail
head -300 output.md > chapter1.md
tail -n +301 output.md | head -300 > chapter2.md
```

### 3.3 创建章节目录

```bash
mkdir -p book-name
mv *.md book-name/
```

---

## Step 4: 单章深度处理

### 4.1 准备处理

```bash
# 复制原始文件作为工作副本
cp 01-chapter1.md 01-chapter1-annotated.md
```

### 4.2 核心 Prompt

```
你是一位专业的学习笔记整理专家。请对这份内容进行深度学习处理：

## 处理要求

1. **段前批注**
   - 在每个重要段落前添加批注
   - 使用图标：💡 核心洞察 / 📌 关键点 / 🎯 定义 / ⚠️ 注意 / 📊 数据
   - 批注简洁，不超过 50 字

2. **表格整理**
   - 将列表式内容转为表格
   - 对比类内容用对比表
   - 分级类内容用分层表

3. **图表可视化**
   - 用 ASCII 图展示逻辑关系
   - 复杂流程用 mermaid

4. **核心概念提炼**
   - 提取关键术语
   - 给出清晰定义

5. **本章小结**
   - 3-5 个核心知识点
   - 关键洞察总结

6. **思考题**
   - 3-5 道反思题
   - 能引发深度思考

## 输出格式

- Markdown 格式
- 层级清晰
- 表格美观
- 中英文对照（如适用）

请开始处理...
```

### 4.3 保存结果

```bash
# 重命名保存
mv processed.md 01-chapter1-annotated.md
```

---

## Step 5: 批量处理

### 5.1 准备批量 Prompt

```
基于第一章的处理风格和格式，请处理第二、三、四章。

保持以下一致：
1. 批注风格（图标使用、长度）
2. 表格格式（列名、样式）
3. 小结结构（知识点 + 洞察）
4. 思考题风格

请逐章处理，每章完成后我会检查。
```

### 5.2 逐章处理

```bash
# 创建处理脚本（可选）
for file in *.md; do
  echo "Processing $file..."
  # AI 处理命令
done
```

### 5.3 进度追踪

创建 `progress.md`:

```markdown
| 章节 | 状态 | 处理时间 | 备注 |
|------|------|----------|------|
| 01 | ✅ | 10min | 样本 |
| 02 | ✅ | 8min | - |
| 03 | ✅ | 12min | - |
| 04 | ✅ | 15min | - |
```

---

## Step 6: 质量审查

### 6.1 审查清单

- [ ] **准确性**
  - 批注是否准确反映原意
  - 表格数据是否正确
  - 概念定义是否精准

- [ ] **完整性**
  - 是否遗漏重要内容
  - 章节是否连贯
  - 思考题是否覆盖重点

- [ ] **可读性**
  - 格式是否统一
  - 表格是否清晰
  - 批注是否简洁

- [ ] **实用性**
  - 能否用于复习
  - 能否用于 AI 对话
  - 能否快速查找

### 6.2 修正流程

```
发现问题 → 记录问题 → AI 修正 → 再次审查 → 通过
```

**修正 Prompt**:
```
请修正以下问题：
1. 第 X 节的批注不准确，应该是...
2. 表格第 X 行数据有误...
3. 缺少 XX 概念的定义...
```

---

## 输出文件结构

```
book-name/
├── README.md                  # 书籍信息
├── 00-raw.md                  # 原始转换
├── 01-chapter1-annotated.md   # 第一章（批注版）
├── 02-chapter2-annotated.md   # 第二章（批注版）
├── 03-chapter3-annotated.md   # 第三章（批注版）
├── 04-chapter4-annotated.md   # 第四章（批注版）
├── progress.md                # 处理进度
└── chapters.md                # 章节索引
```

---

## 时间估算

| 步骤 | 时间（70 页书） |
|------|----------------|
| Step 1: PDF 转文本 | 1 min |
| Step 2: 识别结构 | 2 min |
| Step 3: 拆分章节 | 3 min |
| Step 4: 单章处理 | 10 min |
| Step 5: 批量处理 | 30 min（4 章） |
| Step 6: 质量审查 | 10 min |
| **总计** | **~56 min** |

---

## 常见问题

### Q1: PDF 转换后乱码

**解决**:
```bash
pdftotext -layout -enc GBK input.pdf output.md
```

### Q2: 章节识别不准确

**解决**: 手动检查目录，用页码拆分更准确

### Q3: 批注风格不统一

**解决**: 先做样本，确认后批量，每章审查

### Q4: 处理时间太长

**解决**: 可以只处理核心章节，跳过前言/附录

---

*版本：v1.0 | 更新时间：2026-02-23*
