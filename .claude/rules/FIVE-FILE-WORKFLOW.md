# 五文件工作流使用指南

> 来源：Derrick Choi（OpenAI 工程师）的 5 文件管理法
> 成果：AI 25 小时无人值守完成 3 万行代码的设计工具开发

---

## 核心思想

```
Context Window = RAM（易失，有限）
Filesystem = Disk（持久，无限）

→ 重要的东西写进文件里。
```

---

## 五文件结构

| 文件 | 优先级 | 核心功能 | 关键要素 |
|------|--------|----------|----------|
| `docs/prompt.md` | ★★★★★ | 定义项目边界 | 目标/排除项/交付物/完成标准 |
| `docs/plans.md` | ★★★★★ | 任务拆解与验证 | 1-2 小时里程碑 + 验收命令 |
| `docs/architecture.md` | ★★★ | 技术规范锁定 | 防止架构频繁变更 |
| `docs/implement.md` | ★★★ | 操作手册 | 详细执行步骤 |
| `docs/documentation.md` | ★★ | 进度追踪 | AI 工作日志，实时监控 |

---

## 核心机制

### 1. 防跑偏（prompt.md）

**排除项**是核心——明确不要什么比要什么更重要：

```markdown
## 排除项
- [ ] 不需要移动端适配
- [ ] 不考虑多语言
- [ ] 暂不实现权限系统
```

### 2. 小步快跑（plans.md）

每个里程碑控制在 **1-2 小时** 可完成：

```markdown
### Phase 1: 基础框架

**任务**：
- [ ] 搭建项目结构
- [ ] 配置开发环境

**验收命令**：
```bash
npm run dev
# 预期：无错误启动
```

**状态**：`pending` | `in_progress` | `completed` | `blocked`
```

### 3. 强制验证（plans.md）

**硬性规则**：
- 验证不通过，禁止进入下一阶段
- 每个里程碑必须有可执行验证命令
- AI 执行完每步后必须更新状态

### 4. 架构锁定（architecture.md）

一旦确定技术栈，禁止静默修改：

```markdown
## 架构变更记录
| 日期 | 变更内容 | 理由 | 是否回滚 |
|------|----------|------|----------|
| | | | |

> 规则：架构变更必须更新此文档，禁止静默修改
```

### 5. 错误沉淀（documentation.md）

每次错误都记录，防止重复踩坑：

```markdown
## 遇到的问题
| 问题 | 解决方案 | 状态 |
|------|----------|------|
| Module not found | 安装缺失依赖 | ✅ |
```

---

## 何时使用

| 场景 | 推荐模式 |
|------|----------|
| 复杂开发项目（多模块） | 五文件流 |
| 长期维护项目 | 五文件流 |
| 25 小时 + 无人值守 | 五文件流 |
| 研究/探索任务 | Manus 三文件流 |
| 简单问答/单文件修改 | 不需要 |

---

## 快速启动

```bash
# 方式 1：使用 /plan 命令
/plan

# 方式 2：直接运行初始化脚本
~/.claude/skills/planning-with-files/scripts/init.sh

# 然后：
# 1. 编辑 docs/prompt.md - 定义项目边界
# 2. 编辑 docs/plans.md - 拆解任务 + 验收命令
# 3. 说"开始执行" - AI 按 plans.md 执行
```

---

## 关键数据（Derrick Choi 实测）

| 指标 | 数据 | 意义 |
|------|------|------|
| 持续运行时间 | 25.4 小时 | AI 自主编程最长连续工作记录 |
| 代码产出量 | 3 万行 | 完整设计工具 |
| Token 使用量 | 12.7M | 高效上下文利用 |
| API 调用次数 | 2,106 次 | 1,391 次 shell + 652 次代码补丁 |
| 自动上下文压缩 | 13 次 | 动态优化长对话 |

---

## 避坑指南

**80% 无效开发时间源于**：
1. 目标不明确 → 用 `prompt.md` 解决
2. 缺乏验证机制 → 用 `plans.md` 的强制验收解决

---

## 相关资源

- Skill 位置：`~/.claude/skills/planning-with-files/`
- 模板位置：`~/.claude/skills/planning-with-files/templates/`
- 命令位置：`~/.claude/commands/plan.md`
